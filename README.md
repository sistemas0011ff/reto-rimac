# Proyecto de Gesti√≥n de Citas M√©dicas - RIMAC API Serverless

## Descripci√≥n General

API serverless desarrollada para RIMAC Seguros, implementando una arquitectura hexagonal y Domain-Driven Design (DDD) para la gesti√≥n de citas m√©dicas multi-pa√≠s (Per√∫ y Chile). El sistema utiliza CQRS para separar operaciones de lectura y escritura, aprovechando servicios AWS como Lambda, DynamoDB, SNS, SQS y EventBridge.

## üöÄ Despliegue en Producci√≥n

### Endpoints Desplegados (Ambiente DEV)

- **Base URL**: `https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev`
- **Swagger Documentation**: [https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/docs](https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/docs) ‚≠ê **[INTERFAZ DE PRUEBAS]**

### Endpoints Disponibles

| M√©todo | Endpoint | URL Completa | Descripci√≥n |
|--------|----------|--------------|-------------|
| POST | `/appointment` | `https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/appointment` | Crear nueva cita m√©dica |
| GET | `/appointment/{insuredId}` | `https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/appointment/{insuredId}` | Consultar citas por ID de asegurado |
| GET | `/docs` | `https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/docs` | **üìö Documentaci√≥n Swagger UI - USAR PARA PRUEBAS** |

### üß™ Para Realizar Pruebas

**Usar la interfaz Swagger UI para probar los endpoints:**
### ‚û°Ô∏è [https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/docs](https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/docs)

La interfaz Swagger permite:
- ‚úÖ Probar los endpoints directamente desde el navegador
- ‚úÖ Ver ejemplos de request y response
- ‚úÖ Explorar los modelos de datos
- ‚úÖ Ejecutar pruebas con diferentes par√°metros

## Arquitectura
![Diagrama de Arquitectura](images/DiagramaArquitectura.png)
### Arquitectura Hexagonal y DDD

El proyecto sigue una arquitectura hexagonal con los siguientes componentes:

1. **UI/API [Adaptadores Primarios]**
   - Controladores HTTP y handlers Lambda
   - Gesti√≥n de solicitudes entrantes

2. **Capa de Aplicaci√≥n [Puerto Primario]**
   - Servicios de aplicaci√≥n y orquestaci√≥n
   - Implementaci√≥n de comandos y queries (CQRS)

3. **Casos de Uso [Controladores de L√≥gica de Negocio]**
   - Command Handlers y Query Handlers
   - Validaciones y reglas de negocio espec√≠ficas

4. **Capa de Dominio [N√∫cleo]**
   - Entidades y objetos de valor
   - Eventos de dominio
   - Interfaces de repositorios y servicios

5. **Puertos Secundarios [Interfaces de Dominio]**
   - Contratos para servicios externos
   - Interfaces de adaptadores

6. **Capa de Infraestructura [Adaptadores Secundarios]**
   - Implementaciones de repositorios (DynamoDB)
   - Adaptadores para servicios AWS (SNS, SQS, EventBridge)
   - Procesadores por pa√≠s

7. **Recursos Compartidos [Shared Kernel]**
   - Interfaces CQRS base
   - Utilidades comunes

## Flujo de Procesamiento

### Creaci√≥n de Cita
1. Cliente env√≠a solicitud POST a `/appointment`
2. Handler valida y crea comando `CreateAppointmentCommand`
3. CommandHandler procesa y guarda en DynamoDB
4. Publica evento en SNS seg√∫n el pa√≠s (PE/CL)
5. SQS recibe mensaje filtrado por pa√≠s
6. Procesador espec√≠fico del pa√≠s ejecuta l√≥gica de negocio
7. Publica evento de completado en EventBridge
8. Handler de completado actualiza estado final

### Consulta de Citas
1. Cliente solicita GET `/appointment/{insuredId}`
2. Query Handler recupera datos de DynamoDB
3. Retorna lista de citas del asegurado

## Mapeo del Diagrama vs Implementaci√≥n

### ‚úÖ **Paso 1**: API Gateway ‚Üí Lambda (appointment) ‚Üí DynamoDB
* **Implementado**: `appointmentHandler` con endpoints POST y GET
* **DynamoDB**: `AppointmentsTable` para guardar con estado "pending"

### ‚úÖ **Paso 2**: Lambda (appointment) ‚Üí SNS
* **Implementado**: El handler tiene acceso a los ARNs de los t√≥picos SNS
* **SNS Topics**: `PeruAppointmentTopic` y `ChileAppointmentTopic`

### ‚úÖ **Paso 3**: SNS ‚Üí SQS (por pa√≠s)
* **SQS_PE**: `PeruAppointmentQueue` con suscripci√≥n al topic de Per√∫
* **SQS_CL**: `ChileAppointmentQueue` con suscripci√≥n al topic de Chile
* **FilterPolicy**: Configurado para filtrar por `countryISO`

### ‚úÖ **Paso 4**: SQS ‚Üí Lambda pa√≠s ‚Üí RDS MySQL
* **appointment_pe**: `appointmentPeruHandler` ‚Üí `mysql_pe`
* **appointment_cl**: `appointmentChileHandler` ‚Üí `mysql_cl`
* **VPC**: Ambos handlers configurados con VPC para acceso a RDS

### ‚úÖ **Paso 5**: Lambda pa√≠s ‚Üí EventBridge
* **EventBridge**: `AppointmentEventBus` configurado
* Los handlers de pa√≠s tienen permisos para publicar eventos

### ‚úÖ **Paso 6**: EventBridge ‚Üí SQS ‚Üí Lambda ‚Üí DynamoDB
* **EventBridge Rule**: `AppointmentCompletedRule` para eventos "appointment.completed"
* **SQS**: `AppointmentCompletedQueue` recibe eventos del EventBridge
* **Lambda**: `appointmentCompletedHandler` actualiza estado a "completed" en DynamoDB

### üéØ Verificaci√≥n completa:
Todos los componentes del diagrama est√°n presentes:
* ‚úÖ API Gateway
* ‚úÖ Lambda principal (appointment)
* ‚úÖ DynamoDB
* ‚úÖ SNS
* ‚úÖ SQS por pa√≠s (sqs_pe, sqs_cl)
* ‚úÖ Lambdas por pa√≠s (appointment_pe, appointment_cl)
* ‚úÖ RDS MySQL por pa√≠s (mysql_pe, mysql_cl)
* ‚úÖ EventBridge
* ‚úÖ SQS para confirmaciones
* ‚úÖ Lambda para actualizar estado

## Tecnolog√≠as Utilizadas

- **Runtime**: Node.js 18.x
- **Framework**: Serverless Framework 3.32.1
- **Lenguaje**: TypeScript
- **Base de Datos**: 
  - DynamoDB (almacenamiento de citas)
  - MySQL/RDS (datos espec√≠ficos por pa√≠s)
- **Mensajer√≠a**: 
  - SNS (publicaci√≥n de eventos)
  - SQS (procesamiento as√≠ncrono)
  - EventBridge (eventos de dominio)
- **Testing**: Jest
- **Herramientas**: Webpack, TypeDI, Reflect-metadata

## Prerrequisitos

### Herramientas Requeridas

- **AWS CLI**: Configurado con credenciales v√°lidas
- **Node.js**: Versi√≥n 18.x
- **Serverless Framework**: `npm install -g serverless@3.32.1`
- **TypeScript**: Para desarrollo local
- **MySQL Client**: Para conexi√≥n a RDS

### Configuraci√≥n AWS

1. **Configurar AWS CLI**:
   ```bash
   aws configure
   # Ingresar Access Key ID, Secret Access Key, regi√≥n (us-east-2)
   ```

2. **Crear recursos en AWS**:
   - VPC con subnets privadas
   - Security Groups para Lambda y RDS
   - RDS MySQL (uno para Per√∫, otro para Chile)
   - Roles IAM con permisos necesarios

## Instalaci√≥n y Configuraci√≥n

### Clonar el Repositorio
```bash
git clone https://github.com/sistemas0011ff/reto-rimac.git
cd reto-rimac
```

### Instalar Dependencias
```bash
npm install
```

### Variables de Entorno

Crear archivo `.env` en la ra√≠z del proyecto:

```env
# Base de datos Per√∫
PE_DB_HOST=dbreto-rimac.chg6ac68oakf.us-east-2.rds.amazonaws.com
PE_DB_USER=admin
PE_DB_PASSWORD=Inicios20222022$$$
PE_DB_NAME=medical_appointments_pe
PE_DB_PORT=3306

# Base de datos Chile
CL_DB_HOST=dbreto-rimac.chg6ac68oakf.us-east-2.rds.amazonaws.com
CL_DB_USER=admin
CL_DB_PASSWORD=Inicios20222022$$$
CL_DB_NAME=medical_appointments_cl
CL_DB_PORT=3306

# APIs externas
SWAPI_BASE_URL=http://swapi.py4e.com/api
EARTH_API_BASE_URL=https://api.le-systeme-solaire.net/rest

# AWS Local
LOCAL_AWS_REGION=us-east-2
```

### Inicializaci√≥n de Base de Datos
Para el reto se tiene acceso a BD mysql en rds.
Ejecutar el siguiente comando para crear las tablas en MySQL para ambos pa√≠ses:

```bash
node scripts/initDatabase.js
```

**Salida esperada:**
```
üöÄ Iniciando inicializaci√≥n de bases de datos...
üìä Procesando base de datos de Per√∫...
‚úÖ Conectado a la base de datos de Per√∫
‚úÖ Tabla 'appointments' creada/verificada en Per√∫
‚úÖ Tabla verificada en Per√∫
üîê Conexi√≥n cerrada para Per√∫
üìä Procesando base de datos de Chile...
‚úÖ Conectado a la base de datos de Chile
‚úÖ Tabla 'appointments' creada/verificada en Chile
‚úÖ Tabla verificada en Chile
üîê Conexi√≥n cerrada para Chile
üéâ Inicializaci√≥n de bases de datos completada
```

**Script de inicializaci√≥n (`scripts/initDatabase.js`):**

El script crea autom√°ticamente las tablas `appointments` en ambas bases de datos (Per√∫ y Chile) con la siguiente estructura:

- **Campos principales:**
  - `id`: UUID de la cita
  - `insured_id`: ID del asegurado
  - `schedule_id`: ID del horario m√©dico
  - `country_iso`: C√≥digo del pa√≠s (PE/CL)
  - `status`: Estado de la cita (pending, completed, cancelled, processing)
  - `created_at`: Fecha de creaci√≥n
  - `updated_at`: Fecha de √∫ltima actualizaci√≥n
  - `processed_at`: Fecha de procesamiento

- **√çndices para optimizaci√≥n:**
  - `idx_insured_id`: Para b√∫squedas por asegurado
  - `idx_schedule_id`: Para b√∫squedas por horario
  - `idx_status`: Para filtrar por estado
  - `idx_created_at`: Para ordenamiento temporal
  - `idx_country_iso`: Para filtrar por pa√≠s

- **Restricciones:**
  - Check constraint para validar que `country_iso` sea correcto para cada BD
  - Check constraint para validar estados permitidos

## Ejecuci√≥n

### Desarrollo Local
```bash
# Iniciar en modo offline con todos los servicios locales
npm run start

# Este comando ejecuta:
# 1. Compilaci√≥n TypeScript
# 2. Validaci√≥n de AWS
# 3. Validaci√≥n de base de datos
# 4. Inicializaci√≥n de DynamoDB local
# 5. Serverless offline
```

### Despliegue en AWS

**Prerrequisito**: Tener AWS CLI configurado con las credenciales apropiadas (`aws configure`)

```bash
# Desplegar
serverless deploy --stage dev

```

### Evidencia de Despliegue

Comando ejecutado:
```bash
Fyapeuser@DESKTOP-J1V3S4J MINGW64 /d/retos/reto-servlees-swapi
$ serverless deploy --stage dev
```

Resultado:
```bash
‚úî Service deployed to stack mas-v001-dev (77s)
endpoints:
  POST - https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/appointment
  GET - https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/appointment/{insuredId}
  GET - https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/docs
functions:
  appointmentHandler: mas-v001-dev-appointmentHandler (20 MB)
  getAppointmentsByInsuredHandler: mas-v001-dev-getAppointmentsByInsuredHandler (20 MB)
  appointmentPeruHandler: mas-v001-dev-appointmentPeruHandler (20 MB)
  appointmentChileHandler: mas-v001-dev-appointmentChileHandler (20 MB)
  appointmentCompletedHandler: mas-v001-dev-appointmentCompletedHandler (20 MB)
  swaggerUIHandler: mas-v001-dev-swaggerUIHandler (20 MB)
```

## Documentaci√≥n de la API

### Informaci√≥n General

- **T√≠tulo**: Medical Appointments API
- **Versi√≥n**: 1.0.0
- **Descripci√≥n**: API para gestionar citas m√©dicas - Sistema de agendamiento para asegurados
- **URL Base**: `https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev`
- **Documentaci√≥n Swagger**: [https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/docs](https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/docs)

### Endpoints, Ejemplos en Sagger
![prueba1](images/sa1.png)
![prueba2](images/sa2.png)
![prueba3](images/sa3.png)


#### 1. Crear Cita M√©dica

Registra una nueva solicitud de agendamiento de cita m√©dica. El estado inicial ser√° "pending" y se procesar√° de forma as√≠ncrona.

- **URL**: `/appointment`
- **M√©todo**: `POST`
- **Tags**: `appointments`

**Request Body**

Content-Type: `application/json`

```json
{
  "insuredId": "string",    // ID del asegurado (exactamente 5 d√≠gitos)
  "scheduleId": "string",   // ID del horario m√©dico (n√∫mero positivo)
  "countryISO": "string"    // C√≥digo ISO del pa√≠s (PE o CL)
}
```

**Campos Requeridos**
- `insuredId` (string, pattern: `^\d{5}$`) - ID del asegurado (exactamente 5 d√≠gitos)
- `scheduleId` (string) - ID del horario m√©dico (n√∫mero positivo)
- `countryISO` (string, enum: ['PE', 'CL']) - C√≥digo ISO del pa√≠s

**Ejemplos de Request**

Ejemplo para Per√∫:
```json
{
  "insuredId": "12345",
  "scheduleId": "1001",
  "countryISO": "PE"
}
```

Ejemplo para Chile:
```json
{
  "insuredId": "30001",
  "scheduleId": "2001",
  "countryISO": "CL"
}
```

**Respuestas**

202 - Accepted
```json
{
  "message": "Solicitud de agendamiento en proceso",
  "appointmentId": "123e4567-e89b-12d3-a456-426614174000"
}
```

400 - Bad Request
```json
{
  "message": "string",
  "error": "string"
}
```

500 - Internal Server Error

#### 2. Obtener Citas por Asegurado

Consulta todas las citas m√©dicas de un asegurado espec√≠fico, incluyendo su estado actual (pending, completed, cancelled).

- **URL**: `/appointment/{insuredId}`
- **M√©todo**: `GET`
- **Tags**: `appointments`

**Par√°metros**

| Nombre | Ubicaci√≥n | Tipo | Requerido | Descripci√≥n |
|--------|-----------|------|-----------|-------------|
| insuredId | path | string | S√≠ | ID del asegurado (exactamente 5 d√≠gitos) |

Pattern: `^\d{5}$`

**Ejemplos de Par√°metros**
- Asegurado de Per√∫: `12345`
- Asegurado de Chile: `30001`

**Respuestas**

200 - OK

Lista de citas m√©dicas del asegurado

```json
{
  "insuredId": "string",
  "totalAppointments": "integer",
  "appointments": [
    {
      "id": "string (uuid)",
      "insuredId": "string",
      "scheduleId": "string",
      "countryISO": "string",
      "status": "string",
      "createdAt": "string (date-time)"
    }
  ]
}
```

Ejemplo con citas:
```json
{
  "insuredId": "12345",
  "totalAppointments": 2,
  "appointments": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "insuredId": "12345",
      "scheduleId": "1001",
      "countryISO": "PE",
      "status": "completed",
      "createdAt": "2025-05-22T07:00:00.000Z"
    },
    {
      "id": "456e7890-e89b-12d3-a456-426614174001",
      "insuredId": "12345",
      "scheduleId": "1002",
      "countryISO": "PE",
      "status": "pending",
      "createdAt": "2025-05-22T08:00:00.000Z"
    }
  ]
}
```

Ejemplo sin citas:
```json
{
  "insuredId": "99999",
  "totalAppointments": 0,
  "appointments": []
}
```

400 - Bad Request
```json
{
  "message": "El ID del asegurado debe tener exactamente 5 d√≠gitos",
  "error": "INVALID_INSURED_ID_FORMAT",
  "insuredId": "string"
}
```

500 - Internal Server Error

### Modelos de Datos

#### CreateAppointmentRequest
```typescript
{
  insuredId: string;   // Pattern: ^\d{5}$ - Exactamente 5 d√≠gitos
  scheduleId: string;  // N√∫mero positivo
  countryISO: string;  // Enum: ['PE', 'CL']
}
```

#### Appointment
```typescript
{
  id: string;          // Formato UUID
  insuredId: string;   // ID del asegurado
  scheduleId: string;  // ID del horario m√©dico
  countryISO: string;  // Enum: ['PE', 'CL']
  status: string;      // Enum: ['pending', 'completed', 'cancelled']
  createdAt: string;   // Formato date-time ISO 8601
}
```

#### AppointmentListResponse
```typescript
{
  insuredId: string;           // ID del asegurado consultado
  totalAppointments: integer;  // Total de citas encontradas
  appointments: Appointment[]; // Lista de citas del asegurado
}
```

### Estados de Cita

| Estado | Descripci√≥n |
|--------|-------------|
| `pending` | Cita pendiente de procesamiento |
| `completed` | Cita procesada exitosamente |
| `cancelled` | Cita cancelada |

### C√≥digos de Pa√≠s Soportados

| C√≥digo | Pa√≠s |
|--------|------|
| `PE` | Per√∫ |
| `CL` | Chile |

### Ejemplos de Uso

#### CURL - Crear Cita
```bash
curl -X POST https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/appointment \
  -H "Content-Type: application/json" \
  -d '{
    "insuredId": "12345",
    "scheduleId": "1001",
    "countryISO": "PE"
  }'
```

#### CURL - Consultar Citas
```bash
curl -X GET https://7hqfh1yem0.execute-api.us-east-2.amazonaws.com/dev/appointment/12345
```

## Arquitectura de Mensajer√≠a

### SNS Topics
- `appointment-pe-topic-v001-dev`: Citas de Per√∫
- `appointment-cl-topic-v001-dev`: Citas de Chile

### SQS Queues
- `appointment-pe-queue-v001-dev`: Procesamiento Per√∫
- `appointment-cl-queue-v001-dev`: Procesamiento Chile
- `appointment-completed-queue-v001-dev`: Confirmaciones

### EventBridge
- `appointment-event-bus-v001-dev`: Bus de eventos de dominio
- Eventos publicados:
  - `appointment.created`
  - `appointment.processing`
  - `appointment.completed`
  - `appointment.failed`

## Seguridad y VPC

### Configuraci√≥n VPC
- **VPC ID**: vpc-0a6ba2de9cce21d1c
- **Security Group**: sg-0017dcb23a1cf69cd
- **Subnets**:
  - subnet-021fd4e501e8e96b3
  - subnet-0ac4fae8eec3f5a18
  - subnet-04529b39833629024

### IAM Permissions
El rol de Lambda incluye permisos para:
- DynamoDB (CRUD operations)
- SNS (Publish)
- SQS (Send, Receive, Delete)
- EventBridge (PutEvents)
- VPC (Network interfaces)
- X-Ray (Tracing)

## Testing

### Ejecutar Tests
```bash
# Todos los tests
npm test

# Tests con cobertura
npm run test:coverage

# Tests en modo watch
npm run test:watch
```

### Cobertura de Tests
- Handlers de API
- Servicios de dominio
- Casos de uso (Commands y Queries)
- Adaptadores de infraestructura

### Tests Ejecutados
- `appointment_cl.test.ts`: Procesamiento de citas Chile
- `appointment_completed.test.ts`: Confirmaci√≥n de citas
- `appointment_pe.test.ts`: Procesamiento de citas Per√∫

![test](images/test.png)

## Monitoreo y Observabilidad

### AWS X-Ray
- Tracing habilitado para Lambda y API Gateway
- Permite rastrear el flujo completo de las solicitudes

### CloudWatch Logs
- Logs estructurados por funci√≥n Lambda
- M√©tricas personalizadas para:
  - Tiempos de procesamiento
  - Tasas de error
  - Citas por pa√≠s

## Estructura del Proyecto

```
reto-servlees-swapi/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ di/                    # Contenedor de inyecci√≥n de dependencias
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ handlers/              # Lambda handlers
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ appointment/       # Handlers de citas
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ swaggerUIHandler.ts
‚îÇ   ‚îî‚îÄ‚îÄ contexts/
‚îÇ       ‚îú‚îÄ‚îÄ appointment/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ application/       # Capa de aplicaci√≥n (CQRS)
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dtos/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interfaces/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ queries/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ domain/            # L√≥gica de negocio
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ events/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interfaces/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ports/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ value-objects/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/    # Implementaciones
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ adapters/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ processors/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ repositories/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ shared/                # C√≥digo compartido
‚îÇ           ‚îî‚îÄ‚îÄ cqrs/              # Interfaces CQRS
‚îú‚îÄ‚îÄ test/                          # Tests unitarios
‚îú‚îÄ‚îÄ scripts/                       # Scripts de utilidad
‚îú‚îÄ‚îÄ serverless.yml                 # Configuraci√≥n Serverless
‚îú‚îÄ‚îÄ tsconfig.json                  # Configuraci√≥n TypeScript
‚îú‚îÄ‚îÄ jest.config.ts                 # Configuraci√≥n Jest
‚îî‚îÄ‚îÄ webpack.config.js              # Configuraci√≥n Webpack
```

## Consideraciones de Producci√≥n

1. **Escalabilidad**:
   - DynamoDB en modo PAY_PER_REQUEST
   - Lambda con concurrencia reservada si es necesario
   - SQS con Dead Letter Queues

2. **Seguridad**:
   - Conexiones RDS mediante VPC privada
   - Secrets Manager para credenciales sensibles
   - API Gateway con autorizaci√≥n

3. **Resiliencia**:
   - Reintentos configurados en SQS
   - Circuit breakers en servicios externos
   - Timeouts apropiados por funci√≥n

## Troubleshooting

### Problemas Comunes

1. **Error de conexi√≥n a RDS**:
   - Verificar Security Groups
   - Confirmar que Lambda est√° en la VPC correcta

2. **Mensajes no procesados en SQS**:
   - Revisar filter policies en SNS
   - Verificar permisos IAM

3. **Eventos no llegan a EventBridge**:
   - Confirmar VPC Endpoint configurado
   - Verificar formato de eventos

## Notas Importantes

1. **Procesamiento As√≠ncrono**: Las citas se procesan de forma as√≠ncrona. El endpoint de creaci√≥n retorna inmediatamente con estado 202 (Accepted).

2. **Validaci√≥n de ID**: El ID del asegurado debe tener exactamente 5 d√≠gitos num√©ricos.

3. **Filtrado por Pa√≠s**: El sistema procesa las citas seg√∫n el pa√≠s especificado (PE o CL) utilizando diferentes reglas de negocio.

4. **Estado Inicial**: Todas las citas nuevas inician con estado `pending`.



## Autor

**Arturo Eduardo Fajardo Guti√©rrez** - Desarrollador Senior

